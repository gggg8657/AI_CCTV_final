[GOAL]
Phase 3: Package Detection & Theft Detection 시스템을 구현합니다.

[CONTEXT]
AI_CCTV_final 프로젝트의 Phase 3 구현입니다.

현재 프로젝트 상태:
- Phase 1: Event System (완료) - src/utils/event_bus.py, src/utils/events.py
- Phase 2: Function Calling System (완료) - src/agent/function_calling.py
- Phase 3: Package Detection & Theft Detection (구현 필요)

기술 스택:
- Python 3.9+
- PyTorch
- YOLO v12 nano (ultralytics)
- 기존 EventBus 시스템 통합
- 기존 Function Calling 시스템 통합

[INPUTS]
다음 문서들을 참고하여 구현해주세요:
- docs/PHASE3_DEVELOPMENT_PLAN.md: 전체 개발 기획서
- docs/PHASE3_DESIGN_DOCUMENT.md: 시스템 설계 문서
- docs/PHASE3_IMPLEMENTATION_PLAN.md: 구현 계획서
- docs/PHASE3_REQUIREMENTS.md: 요구사항 명세서
- docs/CODEX_REAL_REVIEW_DISCUSSION.md: Codex 검토 및 합의 사항

기존 코드 참고:
- src/utils/event_bus.py: EventBus 구현
- src/utils/events.py: 이벤트 타입 정의
- src/agent/function_calling.py: Function Calling 시스템
- src/pipeline/engine.py: E2E 파이프라인 엔진

[CONSTRAINTS]
- SOLID 원칙 준수 (특히 DIP, OCP)
- 기존 EventBus와 Function Calling 시스템과 통합
- 타입 힌트 완전성
- Docstring 완전성
- 에러 처리 적절성
- 테스트 가능한 구조

[OUTPUTS]
다음 파일들을 생성/구현해주세요:

1. **src/package_detection/__init__.py**
   - 패키지 초기화

2. **src/package_detection/base.py**
   - BaseDetector (ABC)
   - BaseTracker (ABC)
   - BaseTheftDetector (ABC)
   - Detection, TrackedPackage 데이터 클래스

3. **src/package_detection/detector.py**
   - PackageDetector (YOLO v12 nano 기반)
   - BaseDetector 구현

4. **src/package_detection/tracker.py**
   - PackageTracker (IOU 기반)
   - BaseTracker 구현

5. **src/package_detection/theft_detector.py**
   - TheftDetector (3초 확인 로직, time.monotonic() 기반)
   - BaseTheftDetector 구현

6. **src/utils/events.py** (기존 파일에 추가)
   - PackageDetectedEvent
   - PackageDisappearedEvent
   - TheftDetectedEvent

7. **src/agent/function_calling.py** (기존 파일에 추가)
   - get_package_count()
   - get_package_details()
   - get_activity_log()

[IMPLEMENTATION_REQUIREMENTS]

1. **BaseDetector 인터페이스**
```python
class BaseDetector(ABC):
    @abstractmethod
    def detect(self, frame: np.ndarray) -> List[Detection]:
        """프레임에서 패키지 감지"""
        pass
```

2. **PackageDetector**
   - YOLO v12 nano 사용 (ultralytics)
   - COCO 클래스 매핑: backpack(27), handbag(26), suitcase(28) → package로 처리
   - Detection 반환: bbox, confidence, class_id

3. **BaseTracker 인터페이스**
```python
class BaseTracker(ABC):
    @abstractmethod
    def track(self, detections: List[Detection], timestamp: float) -> List[TrackedPackage]:
        """감지 결과를 추적"""
        pass
```

4. **PackageTracker**
   - IOU 기반 매칭
   - 패키지 ID 관리 (자동 할당)
   - TrackedPackage 상태 관리 (present, missing, stolen)
   - 최대 히스토리 길이 제한 (메모리 관리)

5. **BaseTheftDetector 인터페이스**
```python
class BaseTheftDetector(ABC):
    @abstractmethod
    def check_theft(self, tracked_packages: List[TrackedPackage], timestamp: float) -> Optional[TheftDetectedEvent]:
        """도난 감지 확인"""
        pass
```

6. **TheftDetector**
   - time.monotonic() 기반 3초 확인 로직
   - 프레임 드랍 대비
   - evidence_frames는 최근 N개만 유지 (링 버퍼)

7. **이벤트 통합**
   - EventBus에 이벤트 발행
   - PackageDetectedEvent: 패키지 최초 감지 시
   - PackageDisappearedEvent: 1초 이상 미감지 시
   - TheftDetectedEvent: 3초 이상 미감지 시

8. **Function Calling 통합**
   - get_package_count(): 현재 추적 중인 패키지 수
   - get_package_details(package_id): 특정 패키지 상세 정보
   - get_activity_log(): 최근 활동 로그

[CODE_STYLE]
- PEP 8 준수
- 타입 힌트 필수
- Docstring 필수 (Google style)
- 에러 처리: try-except with logging
- 로깅: logging 모듈 사용 (print 금지)

[VALIDATION]
- 각 클래스는 독립적으로 테스트 가능해야 함
- 의존성 주입 가능한 구조
- Mock 가능한 인터페이스

[REQUEST]
위 요구사항에 따라 Phase 3 시스템을 구현해주세요.
특히 다음 사항을 준수해주세요:
- SOLID 원칙 (특히 DIP, OCP)
- 기존 시스템과의 통합
- 타입 안정성
- 에러 처리
- 메모리 효율성
