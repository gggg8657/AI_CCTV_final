# 다음 단계 작업 계획

**작성일**: 2025-01-21

---

## 🎯 즉시 진행 가능한 작업

### 1. 프로젝트 구조 정리 및 준비 (30분)

#### 1.1 디렉토리 구조 생성
```bash
# 필요한 디렉토리 생성
mkdir -p app/api/{routers,models}
mkdir -p src/database
mkdir -p src/notifications
mkdir -p tests/{unit,integration}
```

#### 1.2 기본 파일 생성
- `app/api/__init__.py`
- `app/api/main.py` (FastAPI 앱)
- `src/database/__init__.py`
- `src/database/db.py` (DB 연결)
- `src/database/models.py` (SQLAlchemy 모델)

**작업 시간**: 30분  
**우선순위**: 높음

---

### 2. 데이터베이스 스키마 설계 검토 (1시간)

#### 2.1 현재 AnomalyEvent와 DB 스키마 매핑 확인
- `AnomalyEvent` → `events` 테이블
- 필드 매핑 검토
- 누락된 필드 확인

#### 2.2 마이그레이션 계획
- Alembic 설정
- 초기 마이그레이션 생성

**작업 시간**: 1시간  
**우선순위**: 높음  
**확인 필요**: 통합 질문 문서의 결정 사항 확인

---

### 3. E2ESystem과 데이터베이스 통합 설계 (1시간)

#### 3.1 EventLogger 확장
- 현재 `EventLogger` 분석
- `save_to_db()` 메서드 추가 계획
- 배치 저장 로직 설계

#### 3.2 이벤트 저장 플로우 설계
```
이벤트 발생 → EventLogger.log_event() 
           → 메모리 버퍼에 추가
           → 배치 저장 (1초마다 또는 10개씩)
           → 데이터베이스 저장
```

**작업 시간**: 1시간  
**우선순위**: 높음

---

### 4. FastAPI 기본 구조 생성 (1시간)

#### 4.1 FastAPI 앱 초기화
- `app/api/main.py` 생성
- 기본 라우터 연결
- CORS 설정
- Swagger UI 확인

#### 4.2 기본 엔드포인트
- `GET /health` - 헬스체크
- `GET /api/v1/` - API 루트

**작업 시간**: 1시간  
**우선순위**: 중간

---

## 🔄 통합 질문 확인 후 진행할 작업

### 5. 멀티 카메라 시스템 구현 (4시간)

**전제 조건**: 통합 질문 문서의 결정 사항 확인 필요

#### 5.1 MultiCameraManager 구현
- E2ESystem 인스턴스 관리
- 카메라 추가/삭제/수정
- 상태 관리

#### 5.2 ResourcePool 구현
- VAD 모델 공유
- VLM 분석기 공유
- Agent Flow 공유
- GPU 메모리 관리

**작업 시간**: 4시간  
**우선순위**: 높음 (Sprint 2)

---

### 6. API 엔드포인트 구현 (6시간)

#### 6.1 인증 API
- 사용자 등록
- 로그인
- 토큰 갱신

#### 6.2 카메라 관리 API
- CRUD 작업
- 시작/중지

#### 6.3 이벤트 API
- 목록 조회
- 상세 조회
- 확인 처리

**작업 시간**: 6시간  
**우선순위**: 높음 (Sprint 1-2)

---

## 📝 문서화 작업

### 7. API 문서 자동 생성 설정 (30분)

- FastAPI 자동 문서화 확인
- Swagger UI 접근 테스트
- OpenAPI 스펙 내보내기

**작업 시간**: 30분  
**우선순위**: 중간

---

## 🧪 테스트 준비

### 8. 테스트 환경 설정 (1시간)

- pytest 설정
- 테스트 데이터베이스 설정
- Mock 객체 준비

**작업 시간**: 1시간  
**우선순위**: 중간

---

## 🎨 UI 통합 준비

### 9. React UI API 클라이언트 준비 (1시간)

- API 클라이언트 구조 설계
- 타입 정의
- 에러 핸들링 구조

**작업 시간**: 1시간  
**우선순위**: 낮음 (Sprint 3)

---

## 📊 우선순위 정리

### 즉시 시작 가능 (통합 질문 확인 불필요)
1. ✅ 프로젝트 구조 정리 (30분)
2. ✅ FastAPI 기본 구조 생성 (1시간)
3. ✅ 테스트 환경 설정 (1시간)

### 통합 질문 확인 후 시작
4. 데이터베이스 스키마 설계 및 구현 (1시간)
5. E2ESystem과 데이터베이스 통합 (1시간)
6. 멀티 카메라 시스템 구현 (4시간)
7. API 엔드포인트 구현 (6시간)

---

## 🚀 추천 시작 순서

### 오늘 할 수 있는 작업 (2-3시간)

1. **프로젝트 구조 정리** (30분)
   - 디렉토리 생성
   - 기본 파일 생성

2. **FastAPI 기본 구조 생성** (1시간)
   - FastAPI 앱 초기화
   - 기본 엔드포인트
   - Swagger UI 확인

3. **통합 질문 문서 검토** (30분)
   - 결정 사항 확인
   - 추가 질문 있으면 논의

4. **데이터베이스 스키마 설계** (1시간)
   - SQLAlchemy 모델 정의
   - Alembic 설정

---

## ❓ 확인이 필요한 사항

다음 사항들을 확인해주시면 바로 구현을 시작하겠습니다:

1. **이벤트 저장 방식**
   - 배치 저장 주기: 1초마다? 10개씩?
   - 동기 vs 비동기?

2. **멀티 카메라 구조**
   - MultiCameraManager가 E2ESystem 관리하는 방식으로 진행?
   - 모델 공유 방식 확인?

3. **API 서버 구조**
   - FastAPI Dependency 방식으로 진행?
   - 별도 프로세스 필요 여부?

4. **WebSocket 설정**
   - 기본 FPS: 5 FPS로 진행?
   - 구독 기반으로 진행?

5. **알림 시스템**
   - 우선순위 기반 발송으로 진행?
   - 중복 방지 시간 윈도우: 5분으로 진행?

---

**다음 액션**: 통합 질문 문서(`INTEGRATION_QUESTIONS.md`)를 검토하고 결정 사항을 알려주시면, 바로 구현을 시작하겠습니다!
