# 애자일 프로젝트 계획서

**프로젝트**: AI CCTV 통합 시스템 - System Integration & 추가 기능 구현  
**시작일**: 2025-01-21  
**방법론**: 애자일 (Scrum)  
**스프린트 주기**: 2주

---

## 1. 프로젝트 개요

### 1.1 목표

VAD + VLM + Agentic AI + UI가 통합된 시스템에 다음 기능을 추가:
- 멀티 카메라 지원
- REST API 서버
- 데이터베이스 통합
- 알림 시스템
- 사용자 인증 및 권한 관리

### 1.2 범위

**포함**:
- 백엔드 API 개발
- 데이터베이스 설계 및 구현
- 프론트엔드-백엔드 통합
- 멀티 카메라 파이프라인
- 알림 시스템
- 인증/인가 시스템

**제외** (Phase 2):
- 모바일 앱
- 분산 처리
- 모델 파인튜닝 도구

---

## 2. 제품 백로그 (Product Backlog)

### 2.1 Epic 정의

#### Epic 1: 멀티 카메라 지원
**목표**: 여러 CCTV 카메라를 동시에 모니터링하고 관리  
**우선순위**: P0  
**예상 스프린트**: 2개

#### Epic 2: REST API 서버
**목표**: 외부 시스템 통합 및 프론트엔드-백엔드 분리  
**우선순위**: P0  
**예상 스프린트**: 2개

#### Epic 3: 데이터베이스 통합
**목표**: 이벤트 및 메타데이터 영구 저장  
**우선순위**: P0  
**예상 스프린트**: 1개

#### Epic 4: 알림 시스템
**목표**: 이상 상황 발생 시 즉시 알림  
**우선순위**: P0  
**예상 스프린트**: 1개

#### Epic 5: 사용자 인증 및 권한 관리
**목표**: 다중 사용자 지원 및 접근 제어  
**우선순위**: P1  
**예상 스프린트**: 1개

---

## 3. 스프린트 계획

### Sprint 1 (Week 1-2): 기반 구축
**목표**: 데이터베이스 및 API 기반 구축

**User Stories**:
1. **US-001**: 데이터베이스 스키마 설계 및 구현 (8 SP)
2. **US-002**: FastAPI 프로젝트 구조 생성 (5 SP)
3. **US-003**: 기본 인증 시스템 구현 (8 SP)
4. **US-004**: 카메라 CRUD API 구현 (5 SP)
5. **US-005**: 이벤트 저장 API 구현 (5 SP)

**Definition of Done**:
- 데이터베이스 마이그레이션 완료
- API 서버 실행 가능
- 기본 인증 동작 확인
- API 문서 자동 생성

**예상 Velocity**: 31 SP

---

### Sprint 2 (Week 3-4): 멀티 카메라 & API 확장
**목표**: 멀티 카메라 지원 및 API 기능 확장

**User Stories**:
1. **US-006**: 멀티 카메라 관리자 구현 (13 SP)
2. **US-007**: 카메라별 독립 파이프라인 구현 (13 SP)
3. **US-008**: 통합 대시보드 API 구현 (8 SP)
4. **US-009**: WebSocket 스트리밍 구현 (8 SP)
5. **US-010**: 통계 집계 API 구현 (5 SP)

**Definition of Done**:
- 최대 16개 카메라 동시 모니터링 가능
- 각 카메라별 독립적인 VAD/VLM/Agent 파이프라인
- 실시간 스트리밍 동작 확인
- 통계 API 정상 동작

**예상 Velocity**: 47 SP

---

### Sprint 3 (Week 5-6): 알림 시스템 & 프론트엔드 통합
**목표**: 알림 시스템 구현 및 UI 통합

**User Stories**:
1. **US-011**: 알림 채널 추상화 (5 SP)
2. **US-012**: 이메일 알림 구현 (5 SP)
3. **US-013**: 웹훅 알림 구현 (5 SP)
4. **US-014**: 알림 규칙 엔진 구현 (8 SP)
5. **US-015**: React UI - API 연동 (13 SP)
6. **US-016**: 실시간 대시보드 통합 (8 SP)

**Definition of Done**:
- 이상 상황 발생 시 이메일/웹훅 알림 발송
- 알림 규칙 설정 가능
- React UI에서 실시간 데이터 표시
- WebSocket을 통한 실시간 업데이트

**예상 Velocity**: 44 SP

---

### Sprint 4 (Week 7-8): 권한 관리 & 최적화
**목표**: 사용자 권한 관리 및 시스템 최적화

**User Stories**:
1. **US-017**: 역할 기반 접근 제어 (RBAC) 구현 (13 SP)
2. **US-018**: 카메라별 접근 권한 관리 (8 SP)
3. **US-019**: 성능 모니터링 도구 추가 (8 SP)
4. **US-020**: 클립 관리 시스템 구현 (8 SP)
5. **US-021**: 시스템 테스트 및 버그 수정 (8 SP)

**Definition of Done**:
- 사용자별 카메라 접근 권한 제어
- 성능 메트릭 수집 및 표시
- 클립 검색/다운로드 기능
- 전체 시스템 통합 테스트 통과

**예상 Velocity**: 45 SP

---

## 4. User Story 상세

### US-001: 데이터베이스 스키마 설계 및 구현

**As a** 시스템 관리자  
**I want** 이벤트와 메타데이터를 데이터베이스에 저장  
**So that** 나중에 분석하고 조회할 수 있다

**Acceptance Criteria**:
- [ ] PostgreSQL 데이터베이스 설정
- [ ] SQLAlchemy 모델 정의 (cameras, events, statistics, users)
- [ ] Alembic 마이그레이션 생성
- [ ] 초기 데이터 시드 스크립트 작성
- [ ] 데이터베이스 연결 테스트 통과

**Tasks**:
1. 데이터베이스 스키마 설계 문서 작성
2. SQLAlchemy 모델 클래스 구현
3. Alembic 설정 및 초기 마이그레이션 생성
4. 데이터베이스 연결 유틸리티 구현
5. 테스트 데이터 생성 스크립트 작성

**Story Points**: 8  
**Priority**: P0

---

### US-002: FastAPI 프로젝트 구조 생성

**As a** 개발자  
**I want** FastAPI 기반 프로젝트 구조를 생성  
**So that** REST API를 체계적으로 개발할 수 있다

**Acceptance Criteria**:
- [ ] FastAPI 앱 기본 구조 생성
- [ ] 라우터 모듈 분리 (cameras, events, stats, auth)
- [ ] 의존성 주입 설정
- [ ] CORS 미들웨어 설정
- [ ] Swagger UI 접근 가능

**Tasks**:
1. `app/api/` 디렉토리 구조 생성
2. FastAPI 앱 초기화 (`main.py`)
3. 라우터 모듈 생성
4. 미들웨어 설정
5. API 문서 자동 생성 확인

**Story Points**: 5  
**Priority**: P0

---

### US-003: 기본 인증 시스템 구현

**As a** 사용자  
**I want** 로그인하고 JWT 토큰을 받을 수 있다  
**So that** API에 인증된 요청을 보낼 수 있다

**Acceptance Criteria**:
- [ ] 사용자 등록 API (`POST /api/v1/auth/register`)
- [ ] 로그인 API (`POST /api/v1/auth/login`)
- [ ] JWT 토큰 발급 및 검증
- [ ] 비밀번호 해싱 (bcrypt)
- [ ] 토큰 갱신 API (`POST /api/v1/auth/refresh`)

**Tasks**:
1. 사용자 모델에 password_hash 필드 추가
2. 비밀번호 해싱 유틸리티 구현
3. JWT 토큰 생성/검증 함수 구현
4. 인증 라우터 구현
5. 인증 미들웨어 구현 (의존성)

**Story Points**: 8  
**Priority**: P0

---

### US-006: 멀티 카메라 관리자 구현

**As a** 시스템 관리자  
**I want** 여러 카메라를 동시에 모니터링할 수 있다  
**So that** 여러 위치를 한 번에 관리할 수 있다

**Acceptance Criteria**:
- [ ] 최대 16개 카메라 동시 지원
- [ ] 카메라 추가/삭제/수정 API
- [ ] 카메라 상태 모니터링 (active/inactive/error)
- [ ] 카메라별 설정 관리 (모델, 임계값 등)
- [ ] 리소스 풀링 (GPU 메모리 관리)

**Tasks**:
1. `MultiCameraManager` 클래스 구현
2. 카메라 등록/해제 로직
3. 카메라 상태 관리 시스템
4. 리소스 할당 및 해제 로직
5. 카메라 관리 API 구현

**Story Points**: 13  
**Priority**: P0

---

### US-007: 카메라별 독립 파이프라인 구현

**As a** 시스템  
**I want** 각 카메라마다 독립적인 VAD/VLM/Agent 파이프라인을 실행  
**So that** 한 카메라의 문제가 다른 카메라에 영향을 주지 않는다

**Acceptance Criteria**:
- [ ] 카메라별 E2ESystem 인스턴스 생성
- [ ] 스레드/프로세스 기반 병렬 처리
- [ ] 카메라별 이벤트 큐 관리
- [ ] 에러 핸들링 및 복구 메커니즘
- [ ] 리소스 사용량 모니터링

**Tasks**:
1. 카메라별 파이프라인 래퍼 클래스 구현
2. 스레드 풀 관리자 구현
3. 이벤트 큐 시스템 구현
4. 에러 핸들링 및 재시도 로직
5. 통합 테스트 작성

**Story Points**: 13  
**Priority**: P0

---

### US-015: React UI - API 연동

**As a** 사용자  
**I want** React UI에서 실제 백엔드 API를 호출  
**So that** Mock 데이터 대신 실제 데이터를 볼 수 있다

**Acceptance Criteria**:
- [ ] API 클라이언트 라이브러리 생성 (`src/lib/api.ts`)
- [ ] 카메라 목록 조회 연동
- [ ] 이벤트 목록 조회 연동
- [ ] 통계 데이터 조회 연동
- [ ] 에러 핸들링 및 로딩 상태 관리

**Tasks**:
1. Axios 기반 API 클라이언트 구현
2. API 엔드포인트 타입 정의
3. React 컴포넌트에서 Mock 데이터 제거
4. API 호출로 교체
5. 에러 바운더리 및 로딩 상태 추가

**Story Points**: 13  
**Priority**: P0

---

## 5. 기술 부채 관리

### 현재 기술 부채
1. **에러 핸들링**: 일부 모듈에서 예외 처리 미흡
2. **로깅**: 구조화된 로깅 시스템 부재
3. **테스트**: 단위 테스트 커버리지 낮음
4. **문서화**: API 문서 자동화 필요

### 해결 계획
- **Sprint 1**: 구조화된 로깅 시스템 도입
- **Sprint 2**: 주요 모듈 단위 테스트 작성
- **Sprint 3**: API 문서 자동화 완료
- **Sprint 4**: 통합 테스트 및 버그 수정

---

## 6. 리스크 관리

| 리스크 | 확률 | 영향 | 완화 전략 |
|--------|------|------|----------|
| GPU 메모리 부족 (멀티 카메라) | 중 | 높음 | 리소스 풀링, 모델 공유, 동적 로딩 |
| API 성능 저하 | 중 | 중 | 캐싱, 비동기 처리, 데이터베이스 인덱싱 |
| 프론트엔드-백엔드 통합 이슈 | 낮 | 중 | 조기 통합, Mock 서버 사용 |
| 데이터베이스 마이그레이션 실패 | 낮 | 높음 | 백업 전략, 롤백 계획 |

---

## 7. 일일 스탠드업

**시간**: 매일 오전 10:00  
**형식**: 
- 어제 한 일
- 오늘 할 일
- 블로커

---

## 8. 스프린트 리뷰 & 회고

**스프린트 리뷰**: 각 스프린트 종료 시 데모  
**스프린트 회고**: 
- 잘한 점
- 개선할 점
- 액션 아이템

---

## 9. 성공 지표

### 기술 지표
- API 응답 시간 < 200ms (p95)
- 멀티 카메라 처리: 16개 동시 모니터링 가능
- 데이터베이스 쿼리 성능 < 100ms

### 비즈니스 지표
- 사용자 만족도 (설문)
- 시스템 안정성 (Uptime > 99%)
- 알림 발송 성공률 > 95%

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025-01-21
