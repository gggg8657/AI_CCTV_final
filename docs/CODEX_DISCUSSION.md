# Codex와의 논의: Phase 3 계획 개선

**논의일**: 2026-01-22  
**참여자**: Codex (코드 개발자), Cursor (프로젝트 관리자)

---

## Codex 피드백 요약

### 주요 지적사항

1. **SOLID 원칙**: ISP, DIP 완전 적용 필요
2. **일정**: 2주 → 2.5주로 조정 권장
3. **성능**: 30 FPS 목표 달성 어려울 수 있음 (20-25 FPS 예상)
4. **설계 개선**: Factory 패턴, 인터페이스 분리 필요

---

## 논의 내용

### 1. Factory 패턴 도입에 대한 논의

**Codex 의견**:
- PackageDetector가 YOLO에 직접 의존하는 것은 DIP 위반
- Factory 패턴으로 다른 모델로 교체 가능하도록 해야 함

**Cursor 의견**:
- ✅ **동의**: Factory 패턴 도입은 확장성을 위해 필요
- ⚠️ **우려**: 초기 구현 시 복잡도 증가 가능
- 💡 **제안**: Sprint 1에서는 간단하게 시작, Sprint 6에서 리팩토링

**결정**:
- **Sprint 1**: YOLO 직접 의존으로 시작 (빠른 프로토타입)
- **Sprint 6**: Factory 패턴으로 리팩토링 (확장성 확보)
- **이유**: 먼저 동작하는 코드를 만들고, 이후 개선

---

### 2. ISP (인터페이스 분리) 적용에 대한 논의

**Codex 의견**:
- BaseDetector에 detect()와 load_model()을 모두 포함하는 것은 ISP 위반
- IDetector와 IModelLoader로 분리해야 함

**Cursor 의견**:
- ✅ **동의**: 이론적으로는 맞음
- ⚠️ **실용성**: 현재 프로젝트에서는 모든 Detector가 모델 로드가 필요
- 💡 **제안**: 향후 확장 시 필요하면 분리 (YAGNI 원칙)

**결정**:
- **현재**: BaseDetector 유지 (실용성 우선)
- **향후**: 다른 Detector 추가 시 ISP 적용 검토
- **이유**: 현재는 단일 Detector만 사용, 과도한 추상화 방지

---

### 3. 일정 조정에 대한 논의

**Codex 의견**:
- 2주는 약간 낙관적, 2.5주가 더 현실적
- YOLO 통합, IOU 튜닝, 통합 테스트에 시간이 더 필요

**Cursor 의견**:
- ✅ **부분 동의**: 일정이 타이트할 수 있음
- 💡 **제안**: 버퍼를 포함한 일정으로 조정
- ⚠️ **우려**: 일정이 길어지면 프로젝트 전체 일정에 영향

**결정**:
- **기본 일정**: 2주 유지 (목표)
- **버퍼 포함**: 2.5주 (실제 일정)
- **우선순위**: 핵심 기능 우선, 부가 기능은 선택적
- **이유**: 목표는 명확하게, 실제 일정은 여유 있게

---

### 4. 성능 목표에 대한 논의

**Codex 의견**:
- 30 FPS는 낙관적, 실제로는 20-25 FPS 예상
- VAD + Package Detection + VLM 통합 시 병목 발생

**Cursor 의견**:
- ✅ **동의**: 성능 목표 조정 필요
- 💡 **제안**: 
  - Phase 3 목표: 20 FPS 이상
  - 최적화 후 목표: 30 FPS
- ⚠️ **우려**: 성능이 낮으면 실시간 처리 어려움

**결정**:
- **Phase 3 목표**: 20 FPS 이상 (현실적 목표)
- **최적화 목표**: 30 FPS (향후 개선)
- **대응 방안**: 
  - 프레임 스킵 옵션 추가
  - 비동기 처리 고려 (Sprint 6)
- **이유**: 먼저 동작 확인, 이후 최적화

---

### 5. TheftDetector 책임 분리에 대한 논의

**Codex 의견**:
- TheftDetector가 상태 관리와 이벤트 생성 모두 담당하는 것은 SRP 위반
- TheftStateManager로 분리 필요

**Cursor 의견**:
- ✅ **동의**: 이론적으로는 맞음
- ⚠️ **복잡도**: 초기에는 단순하게 유지
- 💡 **제안**: 상태 관리가 복잡해지면 분리

**결정**:
- **현재**: TheftDetector에 상태 관리 포함 (단순성 우선)
- **향후**: 상태 관리가 복잡해지면 TheftStateManager 분리
- **이유**: YAGNI 원칙, 필요할 때 리팩토링

---

### 6. 테스트 전략에 대한 논의

**Codex 의견**:
- Mock 객체를 사용한 단위 테스트 필요
- 통합 테스트용 더미 데이터 생성기 필요

**Cursor 의견**:
- ✅ **완전 동의**: 테스트 전략 강화 필요
- 💡 **제안**: TDD 접근, 각 Sprint마다 테스트 작성

**결정**:
- **Sprint 1-5**: 각 Sprint마다 단위 테스트 작성
- **Sprint 6**: 통합 테스트 및 성능 테스트
- **목표**: 코드 커버리지 > 80%
- **이유**: 품질 보장을 위해 필수

---

## 최종 합의사항

### 즉시 적용 (Sprint 1 전)

1. ✅ **에러 처리 강화**: YOLO 모델 로드 실패 시 graceful degradation
2. ✅ **테스트 전략 수립**: TDD 접근, Mock 객체 사용
3. ✅ **설정 외부화**: IOU threshold, max_age 등을 config.yaml로

### Sprint 중 적용

1. ✅ **로깅 개선**: 구조화된 로깅, 성능 메트릭
2. ✅ **메모리 최적화**: TrackedPackage의 detections 리스트 크기 제한
3. ✅ **동시성 처리**: Thread-safe 구현 (Function Calling 통합 시)

### Sprint 6에서 리팩토링

1. ✅ **Factory 패턴 도입**: 확장성을 위한 리팩토링
2. ✅ **성능 최적화**: 비동기 처리, 프레임 스킵 옵션
3. ✅ **ISP 적용 검토**: 필요 시 인터페이스 분리

### 일정 조정

- **기본 일정**: 2주 (목표)
- **실제 일정**: 2.5주 (버퍼 포함)
- **우선순위**: 핵심 기능 우선

### 성능 목표 조정

- **Phase 3 목표**: 20 FPS 이상
- **최적화 목표**: 30 FPS (향후)

---

## 개선된 Phase 3 계획

### 수정된 일정

```
Week 1:
- Day 1-4: Sprint 1 (YOLO 통합) ← 1일 추가
- Day 5-8: Sprint 2 (패키지 추적) ← 1일 추가

Week 2:
- Day 9-10: Sprint 3 (도난 감지) ✅
- Day 11-12: Sprint 4 (이벤트 통합) ✅
- Day 13-14: Sprint 5 (Function Calling) ✅

Week 3 (버퍼):
- Day 15-17: Sprint 6 (통합 및 최적화) ← 1일 추가
```

### 수정된 성공 기준

**기능적 기준**:
- ✅ 패키지 감지 정확도 > 50% (mAP@0.5)
- ✅ 패키지 추적 정확도 > 80%
- ✅ 도난 감지 거짓 경보율 < 5%

**비기능적 기준**:
- ✅ 패키지 감지 FPS > 20 (Phase 3 목표)
- ✅ 최적화 후 FPS > 30 (향후 목표)
- ✅ 전체 파이프라인 레이턴시 < 250ms (조정)
- ✅ 메모리 사용량 < 2GB (추가)
- ✅ 코드 커버리지 > 80%

---

## 다음 단계

1. ✅ Codex 피드백 반영
2. ✅ Phase 3 계획 문서 업데이트
3. ✅ Linear 이슈 업데이트
4. ✅ Sprint 1 시작 준비

---

**논의 완료일**: 2026-01-22  
**합의 도출**: ✅ 완료
